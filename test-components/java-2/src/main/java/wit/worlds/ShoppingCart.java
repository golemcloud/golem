// Generated by `wit-bindgen` 0.37.0. DO NOT EDIT!
package wit.worlds;

import java.nio.charset.StandardCharsets;
import java.util.ArrayList;

import org.teavm.interop.Memory;
import org.teavm.interop.Address;
import org.teavm.interop.Import;
import org.teavm.interop.Export;
import org.teavm.interop.CustomSection;

public final class ShoppingCart{
    private ShoppingCart() {}
    
    public static final class ProductItem {
        public final String productId;
        public final String name;
        public final float price;
        public final int quantity;
        
        public ProductItem(String productId, String name, float price, int quantity) {
            this.productId = productId;
            this.name = name;
            this.price = price;
            this.quantity = quantity;
        }
    }
    
    public static final class Order {
        public final String orderId;
        public final ArrayList<ProductItem> items;
        public final float total;
        public final long timestamp;
        
        public Order(String orderId, ArrayList<ProductItem> items, float total, long timestamp) {
            this.orderId = orderId;
            this.items = items;
            this.total = total;
            this.timestamp = timestamp;
        }
    }
    
    public static final class OrderConfirmation {
        public final String orderId;
        
        public OrderConfirmation(String orderId) {
            this.orderId = orderId;
        }
    }
    
    public static final class CheckoutResult {
        public final byte tag;
        private final Object value;
        
        private CheckoutResult(byte tag, Object value) {
            this.tag = tag;
            this.value = value;
        }
        
        public static CheckoutResult error(String error) {
            return new CheckoutResult(ERROR, error);
        }
        
        public static CheckoutResult success(OrderConfirmation success) {
            return new CheckoutResult(SUCCESS, success);
        }
        
        public String getError() {
            if (this.tag == ERROR) {
                return (String) this.value;
            } else {
                throw new RuntimeException("expected ERROR, got " + this.tag);
            }
        }
        
        public OrderConfirmation getSuccess() {
            if (this.tag == SUCCESS) {
                return (OrderConfirmation) this.value;
            } else {
                throw new RuntimeException("expected SUCCESS, got " + this.tag);
            }
        }
        
        public static final byte ERROR = 0;
        public static final byte SUCCESS = 1;
    }
    
    @Export(name = "initialize-cart")
    private static void wasmExportInitializeCart(int p0, int p1) {
        
        byte[] bytes = new byte[p1];
        Memory.getBytes(org.teavm.interop.Address.fromInt(p0), bytes, 0, p1);
        
        wit.worlds.ShoppingCartImpl.initializeCart(new String(bytes, StandardCharsets.UTF_8));
        
    }
    
    @Export(name = "add-item")
    private static void wasmExportAddItem(int p0, int p1, int p2, int p3, float p4, int p5) {
        
        byte[] bytes = new byte[p1];
        Memory.getBytes(org.teavm.interop.Address.fromInt(p0), bytes, 0, p1);
        
        byte[] bytes0 = new byte[p3];
        Memory.getBytes(org.teavm.interop.Address.fromInt(p2), bytes0, 0, p3);
        
        wit.worlds.ShoppingCartImpl.addItem(new ProductItem(new String(bytes, StandardCharsets.UTF_8), new String(bytes0, StandardCharsets.UTF_8), p4, p5));
        
    }
    
    @Export(name = "remove-item")
    private static void wasmExportRemoveItem(int p0, int p1) {
        
        byte[] bytes = new byte[p1];
        Memory.getBytes(org.teavm.interop.Address.fromInt(p0), bytes, 0, p1);
        
        wit.worlds.ShoppingCartImpl.removeItem(new String(bytes, StandardCharsets.UTF_8));
        
    }
    
    @Export(name = "update-item-quantity")
    private static void wasmExportUpdateItemQuantity(int p0, int p1, int p2) {
        
        byte[] bytes = new byte[p1];
        Memory.getBytes(org.teavm.interop.Address.fromInt(p0), bytes, 0, p1);
        
        wit.worlds.ShoppingCartImpl.updateItemQuantity(new String(bytes, StandardCharsets.UTF_8), p2);
        
    }
    
    @Export(name = "checkout")
    private static int wasmExportCheckout() {
        
        CheckoutResult result = wit.worlds.ShoppingCartImpl.checkout();
        
        switch ((result).tag) {
            case 0: {
                String payload = (result).getError();
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 0).putByte((byte) (0));
                byte[] bytes = (payload).getBytes(StandardCharsets.UTF_8);
                
                org.teavm.interop.Address address = Memory.malloc(bytes.length, 1);
                Memory.putBytes(address, bytes, 0, bytes.length);
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 8).putInt(bytes.length);
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 4).putInt(address.toInt());
                
                break;
            }
            case 1: {
                OrderConfirmation payload2 = (result).getSuccess();
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 0).putByte((byte) (1));
                byte[] bytes3 = ((payload2).orderId).getBytes(StandardCharsets.UTF_8);
                
                org.teavm.interop.Address address4 = Memory.malloc(bytes3.length, 1);
                Memory.putBytes(address4, bytes3, 0, bytes3.length);
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 8).putInt(bytes3.length);
                org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 4).putInt(address4.toInt());
                
                break;
            }
            
            default: throw new AssertionError("invalid discriminant: " + (result).tag);
        }
        return wit.worlds.ShoppingCart.RETURN_AREA;
        
    }
    
    @Export(name = "cabi_post_checkout")
    private static void wasmExportCheckoutPostReturn(int p0) {
        
        switch ((((int) org.teavm.interop.Address.fromInt((p0) + 0).getByte()) & 0xFF)) {
            case 0: {
                Memory.free(org.teavm.interop.Address.fromInt(org.teavm.interop.Address.fromInt((p0) + 4).getInt()), org.teavm.interop.Address.fromInt((p0) + 8).getInt(), 1);
                
                break;
            }
            case 1: {
                Memory.free(org.teavm.interop.Address.fromInt(org.teavm.interop.Address.fromInt((p0) + 4).getInt()), org.teavm.interop.Address.fromInt((p0) + 8).getInt(), 1);
                
                break;
            }
        }
        
    }
    
    @Export(name = "get-cart-contents")
    private static int wasmExportGetCartContents() {
        
        ArrayList<ProductItem> result = wit.worlds.ShoppingCartImpl.getCartContents();
        
        int address2 = Memory.malloc((result).size() * 24, 4).toInt();
        for (int index = 0; index < (result).size(); ++index) {
            ProductItem element = (result).get(index);
            int base = address2 + (index * 24);
            byte[] bytes = ((element).productId).getBytes(StandardCharsets.UTF_8);
            
            org.teavm.interop.Address address = Memory.malloc(bytes.length, 1);
            Memory.putBytes(address, bytes, 0, bytes.length);
            org.teavm.interop.Address.fromInt((base) + 4).putInt(bytes.length);
            org.teavm.interop.Address.fromInt((base) + 0).putInt(address.toInt());
            byte[] bytes0 = ((element).name).getBytes(StandardCharsets.UTF_8);
            
            org.teavm.interop.Address address1 = Memory.malloc(bytes0.length, 1);
            Memory.putBytes(address1, bytes0, 0, bytes0.length);
            org.teavm.interop.Address.fromInt((base) + 12).putInt(bytes0.length);
            org.teavm.interop.Address.fromInt((base) + 8).putInt(address1.toInt());
            org.teavm.interop.Address.fromInt((base) + 16).putFloat((element).price);
            org.teavm.interop.Address.fromInt((base) + 20).putInt((element).quantity);
            
        }
        org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 4).putInt((result).size());
        org.teavm.interop.Address.fromInt((wit.worlds.ShoppingCart.RETURN_AREA) + 0).putInt(address2);
        return wit.worlds.ShoppingCart.RETURN_AREA;
        
    }
    
    @Export(name = "cabi_post_get-cart-contents")
    private static void wasmExportGetCartContentsPostReturn(int p0) {
        
        for (int index = 0; index < (org.teavm.interop.Address.fromInt((p0) + 4).getInt()); ++index) {
            int base = (org.teavm.interop.Address.fromInt((p0) + 0).getInt()) + (index * 24);
            Memory.free(org.teavm.interop.Address.fromInt(org.teavm.interop.Address.fromInt((base) + 0).getInt()), org.teavm.interop.Address.fromInt((base) + 4).getInt(), 1);
            Memory.free(org.teavm.interop.Address.fromInt(org.teavm.interop.Address.fromInt((base) + 8).getInt()), org.teavm.interop.Address.fromInt((base) + 12).getInt(), 1);
            
        }
        Memory.free(org.teavm.interop.Address.fromInt(org.teavm.interop.Address.fromInt((p0) + 0).getInt()), (org.teavm.interop.Address.fromInt((p0) + 4).getInt()) * 24, 4);
        
    }
    
    @CustomSection(name = "component-type:ShoppingCart")
    private static final String __WIT_BINDGEN_COMPONENT_TYPE = "0061736d0d0001000019167769742d636f6d706f6e656e742d656e636f64696e670400079a030141020141150172040a70726f647563742d696473046e616d657305707269636576087175616e746974797903000c70726f647563742d6974656d030000017001017204086f726465722d696473056974656d730205746f74616c760974696d657374616d70770300056f72646572030003017201086f726465722d6964730300126f726465722d636f6e6669726d6174696f6e030005017102056572726f72017300077375636365737301060003000f636865636b6f75742d726573756c7403000701400107757365722d696473010004000f696e697469616c697a652d636172740109014001046974656d0101000400086164642d6974656d010a0140010a70726f647563742d696473010004000b72656d6f76652d6974656d010b0140020a70726f647563742d696473087175616e746974797901000400147570646174652d6974656d2d7175616e74697479010c0140000008040008636865636b6f7574010d01400000020400116765742d636172742d636f6e74656e7473010e040016676f6c656d3a69742f73686f7070696e672d6361727404000b1301000d73686f7070696e672d63617274030000004d0970726f647563657273010c70726f6365737365642d6279020d7769742d636f6d706f6e656e7407302e3232332e30167769742d62696e6467656e2d746561766d2d6a61766106302e33372e30";
    
    public static final int RETURN_AREA = Memory.malloc(12, 4).toInt();
}
