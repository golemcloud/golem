package golem:it;

interface api {
  use golem:rdbms/postgres@0.0.2.{db-result as postgres-db-result};
  use golem:rdbms/mysql@0.0.2.{db-result as mysql-db-result};

  enum transaction-end {
    commit,
    rollback,
    none
  }

  enum statement-action {
    execute,
    query,
    query-stream
  }

  record statement {
    statement: string,
    params: list<string>,
    action: statement-action,
    sleep: option<u64>
  }

  variant mysql-result {
     execute(u64),
     query(mysql-db-result)
  }

  variant postgres-result {
    execute(u64),
    query(postgres-db-result)
  }

  check: func() -> string;

  mysql-transaction: func(statements: list<statement>, end: transaction-end) -> result<list<mysql-result>, string>;

  mysql-executions: func(statements: list<statement>) -> result<list<mysql-result>, string>;

  postgres-transaction: func(statements: list<statement>, end: transaction-end) -> result<list<postgres-result>, string>;

  postgres-executions: func(statements: list<statement>) -> result<list<postgres-result>, string>;

}

world rdbms-service {
  import golem:rdbms/postgres@0.0.2;
  import golem:rdbms/mysql@0.0.2;
  export api;
}