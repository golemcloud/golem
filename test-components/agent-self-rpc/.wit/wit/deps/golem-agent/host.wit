package golem:agent;

interface host {
    use golem:rpc/types@0.2.2.{component-id, uuid, promise-id, wit-value};
    use common.{agent-error, agent-type, data-value, registered-agent-type};

    /// Gets all the registered agent types
    get-all-agent-types: func() -> list<registered-agent-type>;

    /// Get a specific registered agent type by name
    get-agent-type: func(agent-type-name: string) -> option<registered-agent-type>;

    /// Constructs a string agent-id from the agent type and its constructor parameters
    /// and an optional phantom ID
    make-agent-id: func(agent-type-name: string, input: data-value, phantom-id: option<uuid>) -> result<string, agent-error>;

    /// Parses an agent-id (created by `make-agent-id`) into an agent type name and its constructor parameters
    /// and an optional phantom ID
    parse-agent-id: func(agent-id: string) -> result<tuple<string, data-value, option<uuid>>, agent-error>;

    /// Creates a webhook that can be used to integrate with webhook driven apis.
    /// When the created url is called with a post request, the provided promise-id is completed with the body of the post request.
    /// Note the following behaviours:
    /// * Only agents whoose agent types are _currently_ deployed via an http api are allowed to create a webhook. Calling this function while the agent
    ///    is not deployed via an http api will trap.
    /// * Only the agent type that created the promise is allowed to create a webhook for it. Using this host function
    ///   from a different agent type will trap.
    create-webhook: func(promise-id: promise-id) -> string;

    /// Get the current value of the config key.
    /// Only keys that are declared by the agent-type are allowed to be accessed. Trying
    /// to access an undeclared key will trap.
    /// Getting a local key will get values defined as part of the current
    /// component revision + overrides declared during agent creation.
    /// Getting a shared key will get the current value of the key in the environment.
    get-config-value: func(key: list<string>) -> result<wit-value>;
}
