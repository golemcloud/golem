syntax = "proto3";

package golem.apidefinition;

import "golem/rib/expr.proto";
import "golem/rib/rib_input.proto";
import "golem/rib/rib_output.proto";
import "golem/rib/rib_byte_code.proto";
import "golem/rib/worker_functions_in_rib.proto";
import "golem/component/component_id.proto";
import "golem/component/agent.proto";
import "golem/common/empty.proto";
import "golem/common/uuid.proto";
import "golem/common/account_id.proto";
import "golem/common/environment.proto";
import "google/protobuf/timestamp.proto";

message SecuritySchemeId {
  golem.common.UUID value = 1;
}

message CompiledRoutes {
  golem.common.AccountId account_id = 1;
  golem.common.EnvironmentId environment_id = 2;
  uint64 deployment_revision = 3;
  repeated SecuritySchemeDetails security_schemes = 4;
  repeated CompiledRoute compiled_routes = 5;
}

message CompiledRoute {
   golem.component.HttpMethod method = 1;
   string path = 2;
   RouteBehaviour behaviour = 3;
   optional SecuritySchemeId security_scheme_id = 4;
   golem.component.CorsOptions cors_options = 5;
}

message RouteBehaviour {
  oneof behavior {
    CallAgent call_agent = 1;
    golem.common.Empty serve_swagger_ui = 2;
    golem.common.Empty handle_webhook_callback = 3;
  }
}

message CallAgent {
  string agent_type = 1;
  string method_name = 2;
  golem.component.DataSchema input_schema = 3;
  golem.component.DataSchema output_schema = 4;
}

message SecuritySchemeDetails {
  SecuritySchemeId id = 1;
  string name = 2;
  Provider provider = 3;
  string client_id = 4;
  string client_secret = 5;
  string redirect_url = 6;
  repeated string scopes = 7;
}

enum Provider {
  PROVIDER_UNSPECIFIED = 0;
  PROVIDER_GOOGLE = 1;
  PROVIDER_FACEBOOK = 2;
  PROVIDER_MICROSOFT = 3;
  PROVIDER_GITLAB = 4;
}
